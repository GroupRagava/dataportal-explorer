!function t(e,i,r){function s(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(n)return n(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return s(i?i:t)},u,u.exports,t,e,i,r)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(t,e,i){i.read=function(t,e,i,r,s){var n,o,a=8*s-r-1,l=(1<<a)-1,h=l>>1,u=-7,c=i?s-1:0,f=i?-1:1,d=t[e+c];for(c+=f,n=d&(1<<-u)-1,d>>=-u,u+=a;u>0;n=256*n+t[e+c],c+=f,u-=8);for(o=n&(1<<-u)-1,n>>=-u,u+=r;u>0;o=256*o+t[e+c],c+=f,u-=8);if(0===n)n=1-h;else{if(n===l)return o?NaN:(d?-1:1)*(1/0);o+=Math.pow(2,r),n-=h}return(d?-1:1)*o*Math.pow(2,n-r)},i.write=function(t,e,i,r,s,n){var o,a,l,h=8*n-s-1,u=(1<<h)-1,c=u>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:n-1,p=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),e+=o+c>=1?f/l:f*Math.pow(2,1-c),e*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(e*l-1)*Math.pow(2,s),o+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,s),o=0));s>=8;t[i+d]=255&a,d+=p,a/=256,s-=8);for(o=o<<s|a,h+=s;h>0;t[i+d]=255&o,d+=p,o/=256,h-=8);t[i+d-p]|=128*y}},{}],2:[function(t,e,i){"use strict";function r(t){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.length=this.buf.length}function s(t,e,i){var r,s,n=i.buf;if(s=n[i.pos++],r=(112&s)>>4,s<128)return o(t,r,e);if(s=n[i.pos++],r|=(127&s)<<3,s<128)return o(t,r,e);if(s=n[i.pos++],r|=(127&s)<<10,s<128)return o(t,r,e);if(s=n[i.pos++],r|=(127&s)<<17,s<128)return o(t,r,e);if(s=n[i.pos++],r|=(127&s)<<24,s<128)return o(t,r,e);if(s=n[i.pos++],r|=(1&s)<<31,s<128)return o(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function n(t){return(7&t.buf[t.pos-1])===r.Bytes?t.readVarint()+t.pos:t.pos+1}function o(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function a(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),4294967295^i?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),l(i,r,e),h(r,e)}function l(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}function h(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function u(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function c(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function v(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function x(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function w(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function m(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function F(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function _(t,e,i){for(var r="",s=e;s<i;){var n=t[s],o=null,a=n>239?4:n>223?3:n>191?2:1;if(s+a>i)break;var l,h,u;1===a?n<128&&(o=n):2===a?(l=t[s+1],128===(192&l)&&(o=(31&n)<<6|63&l,o<=127&&(o=null))):3===a?(l=t[s+1],h=t[s+2],128===(192&l)&&128===(192&h)&&(o=(15&n)<<12|(63&l)<<6|63&h,(o<=2047||o>=55296&&o<=57343)&&(o=null))):4===a&&(l=t[s+1],h=t[s+2],u=t[s+3],128===(192&l)&&128===(192&h)&&128===(192&u)&&(o=(15&n)<<18|(63&l)<<12|(63&h)<<6|63&u,(o<=65535||o>=1114112)&&(o=null))),null===o?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|1023&o),r+=String.fromCharCode(o),s+=a}return r}function L(t,e,i){for(var r,s,n=0;n<e.length;n++){if(r=e.charCodeAt(n),r>55295&&r<57344){if(!s){r>56319||n+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}e.exports=r;var T=t("ieee754");r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var S=4294967296,M=1/S;r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,n=this.pos;t(s,e,this),this.pos===n&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=b(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=F(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=b(this.buf,this.pos)+b(this.buf,this.pos+4)*S;return this.pos+=8,t},readSFixed64:function(){var t=b(this.buf,this.pos)+F(this.buf,this.pos+4)*S;return this.pos+=8,t},readFloat:function(){var t=T.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=T.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return i=r[this.pos++],e=127&i,i<128?e:(i=r[this.pos++],e|=(127&i)<<7,i<128?e:(i=r[this.pos++],e|=(127&i)<<14,i<128?e:(i=r[this.pos++],e|=(127&i)<<21,i<128?e:(i=r[this.pos],e|=(15&i)<<28,s(e,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=_(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=n(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=n(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),m(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),m(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),m(this.buf,t&-1,this.pos),m(this.buf,Math.floor(t*M),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),m(this.buf,t&-1,this.pos),m(this.buf,Math.floor(t*M),this.pos+4),this.pos+=8},writeVarint:function(t){return t=+t||0,t>268435455||t<0?void a(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),void(t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=L(this.buf,t,this.pos),i=e-this.pos;i>=128&&u(this.pos,i,this),this.pos--,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),T.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),T.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&u(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,c,e)},writePackedSVarint:function(t,e){this.writeMessage(t,f,e)},writePackedBoolean:function(t,e){this.writeMessage(t,y,e)},writePackedFloat:function(t,e){this.writeMessage(t,d,e)},writePackedDouble:function(t,e){this.writeMessage(t,p,e)},writePackedFixed32:function(t,e){this.writeMessage(t,v,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,g,e)},writePackedFixed64:function(t,e){this.writeMessage(t,x,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,w,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},{ieee754:1}],3:[function(t,e,i){"use strict";function r(t,e){this.x=t,this.y=e}e.exports=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,s=i*this.x+e*this.y;return this.x=r,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t}},{}],4:[function(t,e,i){e.exports.VectorTile=t("./lib/vectortile.js"),e.exports.VectorTileFeature=t("./lib/vectortilefeature.js"),e.exports.VectorTileLayer=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":5,"./lib/vectortilefeature.js":6,"./lib/vectortilelayer.js":7}],5:[function(t,e,i){"use strict";function r(t,e){this.layers=t.readFields(s,{},e)}function s(t,e,i){if(3===t){var r=new n(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var n=t("./vectortilelayer");e.exports=r},{"./vectortilelayer":7}],6:[function(t,e,i){"use strict";function r(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(s,this,e)}function s(t,e,i){1==t?e.id=i.readVarint():2==t?n(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function n(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[r]=s}}function o(t){var e=t.length;if(e<=1)return[t];for(var i,r,s=[],n=0;n<e;n++){var o=a(t[n]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&s.push(i),i=[t[n]]):i.push(t[n]))}return i&&s.push(i),s}function a(t){for(var e,i,r=0,s=0,n=t.length,o=n-1;s<n;o=s++)e=t[s],i=t[o],r+=(i.x-e.x)*(e.y+i.y);return r}var l=t("point-geometry");e.exports=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,s=0,n=0,o=0,a=[];t.pos<i;){if(!s){var h=t.readVarint();r=7&h,s=h>>3}if(s--,1===r||2===r)n+=t.readSVarint(),o+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new l(n,o));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},r.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,n=0,o=1/0,a=-(1/0),l=1/0,h=-(1/0);t.pos<e;){if(!r){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)s+=t.readSVarint(),n+=t.readSVarint(),s<o&&(o=s),s>a&&(a=s),n<l&&(l=n),n>h&&(h=n);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,a,h]},r.prototype.toGeoJSON=function(t,e,i){function s(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+u)/l;t[e]=[360*(i.x+h)/l-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}var n,a,l=this.extent*Math.pow(2,i),h=this.extent*t,u=this.extent*e,c=this.loadGeometry(),f=r.types[this.type];switch(this.type){case 1:var d=[];for(n=0;n<c.length;n++)d[n]=c[n][0];c=d,s(c);break;case 2:for(n=0;n<c.length;n++)s(c[n]);break;case 3:for(c=o(c),n=0;n<c.length;n++)for(a=0;a<c[n].length;a++)s(c[n][a])}1===c.length?c=c[0]:f="Multi"+f;var p={type:"Feature",geometry:{type:f,coordinates:c},properties:this.properties};return"id"in this&&(p.id=this.id),p}},{"point-geometry":3}],7:[function(t,e,i){"use strict";function r(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(s,this,e),this.length=this._features.length}function s(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(n(i))}function n(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}var o=t("./vectortilefeature.js");e.exports=r,r.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,e,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":6}],8:[function(t,e,r){function s(t,e,i,r,s){if(!e)return null;for(var o in e)this[o]=e[o];this.mvtLayer=t,this.mvtSource=t.mvtSource,this.map=t.mvtSource.map,this.id=r,this.layerLink=this.mvtSource.layerLink,this.toggleEnabled=!0,this.selected=!1,this.divisor=e.extent/i.tileSize,this.extent=e.extent,this.tileSize=i.tileSize,this.tiles={},this.style=s,this.addTileFeature(e,i);var a=this;this.map.on("zoomend",function(){a.staticLabel=null}),s&&s.dynamicLabel&&"function"==typeof s.dynamicLabel&&(this.dynamicLabel=this.mvtSource.dynamicLabel.createFeature(this)),n(a)}function n(t){var e=t.style;if(e&&e.ajaxSource&&"function"==typeof e.ajaxSource){var i=e.ajaxSource(t);i&&l.getJSON(i,function(e,i,r){if(e)throw["ajaxSource AJAX Error",e];return o(t,i),!0})}return!1}function o(t,e){t.ajaxData=e,"function"==typeof t.ajaxDataReceived&&t.ajaxDataReceived(t,e),t._setStyle(t.mvtLayer.style),a(t)}function a(t){var e=t.tiles,i=t.mvtLayer;for(var r in e){var s=parseInt(r.split(":")[0]),n=t.map.getZoom();s===n&&i.redrawTile(r)}}var l=t("./MVTUtil"),h=t("./StaticLabel/StaticLabel.js");e.exports=s,s.prototype._setStyle=function(t){this.style=t(this,this.ajaxData),this.removeLabel()},s.prototype.setStyle=function(t){this.ajaxData=null,this.style=t(this,null);var e=n(this);e||this.removeLabel()},s.prototype.draw=function(t){var e=this.tiles[t],i=e.vtf,r=e.ctx,s=t.split(":").slice(1,3).join(":");if(r.canvas=this.mvtLayer._tiles[s],this.selected)var n=this.style.selected||this.style;else var n=this.style;switch(i.type){case 1:if(this._drawPoint(r,i.coordinates,n),!this.staticLabel&&"function"==typeof this.style.staticLabel){if(this.style.ajaxSource&&!this.ajaxData)break;this._drawStaticLabel(r,i.coordinates,n)}break;case 2:this._drawLineString(r,i.coordinates,n);break;case 3:this._drawPolygon(r,i.coordinates,n);break;default:throw new Error("Unmanaged type: "+i.type)}},s.prototype.getPathsForTile=function(t){return this.tiles[t].paths},s.prototype.addTileFeature=function(t,e){var i=this.map.getZoom();e.zoom==i&&(this.clearTileFeatures(i),this.tiles[e.id]={ctx:e,vtf:t,paths:[]})},s.prototype.clearTileFeatures=function(t){for(var e in this.tiles)e.split(":")[0]!=t&&delete this.tiles[e]},s.prototype.toggle=function(){this.selected?this.deselect():this.select()},s.prototype.select=function(){this.selected=!0,this.mvtSource.featureSelected(this),a(this);var t=this.linkedFeature();t&&t.staticLabel&&!t.staticLabel.selected&&t.staticLabel.select()},s.prototype.deselect=function(){this.selected=!1,this.mvtSource.featureDeselected(this),a(this);var t=this.linkedFeature();t&&t.staticLabel&&t.staticLabel.selected&&t.staticLabel.deselect()},s.prototype.on=function(t,e){this._eventHandlers[t]=e},s.prototype._drawPoint=function(t,e,i){if(i&&t&&t.canvas){var r=this.tiles[t.id],s=1;s="function"==typeof i.radius?i.radius(t.zoom):i.radius;var n,o=this._tilePoint(e[0][0]),a=t.canvas;try{n=a.getContext("2d")}catch(t){return void console.log("_drawPoint error: "+t)}n.beginPath(),n.fillStyle=i.color,n.arc(o.x,o.y,s,0,2*Math.PI),n.closePath(),n.fill(),i.lineWidth&&i.strokeStyle&&(n.lineWidth=i.lineWidth,n.strokeStyle=i.strokeStyle,n.stroke()),n.restore(),r.paths.push([o])}},s.prototype._drawLineString=function(t,e,r){if(r&&t&&t.canvas){var s=t.canvas.getContext("2d");s.strokeStyle=r.color,s.lineWidth=r.size,s.beginPath();var n=[],o=this.tiles[t.id];for(var a in e){var l=e[a];for(i=0;i<l.length;i++){var h=(0===i?"move":"line")+"To",u=this._tilePoint(l[i]);n.push(u),s[h](u.x,u.y)}}s.stroke(),s.restore(),o.paths.push(n)}},s.prototype._drawPolygon=function(t,e,i){if(i&&t&&t.canvas){var r=t.canvas.getContext("2d"),s=i.outline;"function"==typeof i.color?r.fillStyle=i.color(r):r.fillStyle=i.color,s&&(r.strokeStyle=s.color,r.lineWidth=s.size),r.beginPath();var n=[],o=this.tiles[t.id],a=this.dynamicLabel;a&&a.addTilePolys(t,e);for(var l=0,h=e.length;l<h;l++)for(var u=e[l],c=0;c<u.length;c++){var f=(u[c],(0===c?"move":"line")+"To"),d=this._tilePoint(u[c]);n.push(d),r[f](d.x,d.y)}r.closePath(),r.fill(),s&&r.stroke(),o.paths.push(n)}},s.prototype._drawStaticLabel=function(t,e,i){if(i&&t&&this.mvtLayer._map){var r=this._tilePoint(e[0][0]),s=this._project(r,t.tile.x,t.tile.y,this.extent,this.tileSize),n=L.point(s.x,s.y),o=this.map.unproject(n);this.staticLabel=new h(this,t,o,i),this.mvtLayer.featureWithLabelAdded(this)}},s.prototype.removeLabel=function(){this.staticLabel&&(this.staticLabel.remove(),this.staticLabel=null)},s.prototype._project=function(t,e,i,r,s){var n=e*s,o=i*s;return{x:Math.floor(t.x+n),y:Math.floor(t.y+o)}},s.prototype._tilePoint=function(t){return new L.Point(t.x/this.divisor,t.y/this.divisor)},s.prototype.linkedFeature=function(){var t=this.mvtLayer.linkedLayer();if(t){var e=t.features[this.id];return e}return null}},{"./MVTUtil":11,"./StaticLabel/StaticLabel.js":12}],9:[function(require,module,exports){function removeLabels(t){for(var e=t.featuresWithLabels,i=0,r=e.length;i<r;i++){var s=e[i];s.removeLabel()}t.featuresWithLabels=[]}function in_circle(t,e,i,r,s){var n=Math.pow(t-r,2)+Math.pow(e-s,2);return n<=Math.pow(i,2)}function waitFor(testFx,onReady,timeOutMillis){var maxtimeOutMillis=timeOutMillis?timeOutMillis:3e3,start=(new Date).getTime(),condition="string"==typeof testFx?eval(testFx):testFx(),interval=setInterval(function(){(new Date).getTime()-start<maxtimeOutMillis&&!condition?condition="string"==typeof testFx?eval(testFx):testFx():condition?(console.log("'waitFor()' finished in "+((new Date).getTime()-start)+"ms."),clearInterval(interval),"string"==typeof onReady?eval(onReady):onReady("success")):(console.log("'waitFor()' timeout"),clearInterval(interval),"string"==typeof onReady?eval(onReady):onReady("timeout"))},50)}var MVTFeature=require("./MVTFeature"),Util=require("./MVTUtil");module.exports=L.TileLayer.Canvas.extend({options:{debug:!1,isHiddenLayer:!1,getIDForLayerFeature:function(){},tileSize:256,lineClickTolerance:2},_featureIsClicked:{},_isPointInPoly:function(t,e){if(e&&e.length){for(var i=!1,r=-1,s=e.length,n=s-1;++r<s;n=r)(e[r].y<=t.y&&t.y<e[n].y||e[n].y<=t.y&&t.y<e[r].y)&&t.x<(e[n].x-e[r].x)*(t.y-e[r].y)/(e[n].y-e[r].y)+e[r].x&&(i=!i);return i}},_getDistanceFromLine:function(t,e){var i=Number.POSITIVE_INFINITY;if(e&&e.length>1){t=L.point(t.x,t.y);for(var r=0,s=e.length-1;r<s;r++){var n=this._projectPointOnLineSegment(t,e[r],e[r+1]);n.distance<=i&&(i=n.distance)}}return i},_projectPointOnLineSegment:function(t,e,i){var r=e.distanceTo(i);if(r<1)return{distance:t.distanceTo(e),coordinate:e};var s=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/Math.pow(r,2);if(s<1e-7)return{distance:t.distanceTo(e),coordinate:e};if(s>.9999999)return{distance:t.distanceTo(i),coordinate:i};var n=L.point(e.x+s*(i.x-e.x),e.y+s*(i.y-e.y));return{distance:t.distanceTo(n),point:n}},initialize:function(t,e){var i=this;i.mvtSource=t,L.Util.setOptions(this,e),this.style=e.style,this.name=e.name,this._canvasIDToFeatures={},this.features={},this.featuresWithLabels=[],this._highestCount=0},onAdd:function(t){var e=this;e.map=t,L.TileLayer.Canvas.prototype.onAdd.call(this,t),t.on("layerremove",function(t){t.layer._leaflet_id===e._leaflet_id&&removeLabels(e)})},drawTile:function(t,e,i){var r={canvas:t,tile:e,zoom:i,tileSize:this.options.tileSize};r.id=Util.getContextID(r),this._canvasIDToFeatures[r.id]||this._initializeFeaturesHash(r),this.features||(this.features={})},_initializeFeaturesHash:function(t){this._canvasIDToFeatures[t.id]={},this._canvasIDToFeatures[t.id].features=[],this._canvasIDToFeatures[t.id].canvas=t.canvas},_draw:function(t){},getCanvas:function(t){var e=t.tile,i=this._tiles[e.x+":"+e.y];if(i)return t.canvas=i,void this.redrawTile(t.id);var r=this;waitFor(function(){if(i=r._tiles[e.x+":"+e.y])return!0},function(){i=r._tiles[e.x+":"+e.y],t.canvas=i,r.redrawTile(t.id)},2e3)},parseVectorTileLayer:function(t,e){var i=this,r=e.tile,s={canvas:null,id:e.id,tile:e.tile,zoom:e.zoom,tileSize:e.tileSize};s.canvas=i._tiles[r.x+":"+r.y],this._canvasIDToFeatures[s.id]?this.clearTileFeatureHash(s.id):this._initializeFeaturesHash(s);for(var n=t.parsedFeatures,o=0,a=n.length;o<a;o++){var l=n[o];l.layer=t;var h=i.options.filter;if("function"!=typeof h||h(l,s)!==!1){var u;u="function"==typeof i.options.getIDForLayerFeature?i.options.getIDForLayerFeature:Util.getIDForLayerFeature;var c=i.options.getIDForLayerFeature(l)||o,f=i.features[c],d=i.options.layerOrdering;if("function"==typeof d&&d(l,s),f)f.addTileFeature(l,s);else{var p=i.style(l);i.features[c]=f=new MVTFeature(i,l,s,c,p),p&&p.dynamicLabel&&"function"==typeof p.dynamicLabel&&i.featuresWithLabels.push(f)}s&&s.id&&i._canvasIDToFeatures[s.id].features.push(f)}}var d=i.options.layerOrdering;d&&(i._canvasIDToFeatures[s.id].features=i._canvasIDToFeatures[s.id].features.sort(function(t,e){return-(e.properties.zIndex-t.properties.zIndex)})),i.redrawTile(s.id)},setStyle:function(t){this._highestCount=0,this._lowestCount=null,this.style=t;for(var e in this.features){var i=this.features[e];i.setStyle(t)}var r=this.map.getZoom();for(var e in this._tiles){var s=r+":"+e;this.redrawTile(s)}},setHighestCount:function(t){t>this._highestCount&&(this._highestCount=t)},getHighestCount:function(){return this._highestCount},setLowestCount:function(t){(!this._lowestCount||t<this._lowestCount)&&(this._lowestCount=t)},getLowestCount:function(){return this._lowestCount},setCountRange:function(t){this.setHighestCount(t),this.setLowestCount(t)},handleClickEvent:function(t,e){var i=t.tileID.split(":").slice(1,3).join(":"),r=t.tileID.split(":")[0],s=this._tiles[i];s||e(t);for(var n,o,a,l=t.layerPoint.x-s._leaflet_pos.x,h=t.layerPoint.y-s._leaflet_pos.y,u={x:l,y:h},c=this._canvasIDToFeatures[t.tileID].features,f=Number.POSITIVE_INFINITY,d=null,p=0;p<c.length;p++){var y=c[p];switch(y.type){case 1:var v=3;for(v="function"==typeof y.style.radius?y.style.radius(r):y.style.radius,o=y.getPathsForTile(t.tileID),n=0;n<o.length;n++)in_circle(o[n][0].x,o[n][0].y,v,l,h)&&(d=y,f=0);break;case 2:for(o=y.getPathsForTile(t.tileID),n=0;n<o.length;n++)if(y.style){var a=this._getDistanceFromLine(u,o[n]),g=y.selected&&y.style.selected?y.style.selected.size:y.style.size;a<g/2+this.options.lineClickTolerance&&a<f&&(d=y,f=a)}break;case 3:for(o=y.getPathsForTile(t.tileID),n=0;n<o.length;n++)this._isPointInPoly(u,o[n])&&(d=y,f=0)}if(0==f)break}d&&d.toggleEnabled&&d.toggle(),t.feature=d,e(t)},clearTile:function(t){var e=t.split(":"),i=e[1]+":"+e[2];if("undefined"==typeof this._tiles[i])return void console.error("typeof this._tiles[canvasId] === 'undefined'");var r=this._tiles[i],s=r.getContext("2d");s.clearRect(0,0,r.width,r.height)},clearTileFeatureHash:function(t){this._canvasIDToFeatures[t]={features:[]}},clearLayerFeatureHash:function(){this.features={}},redrawTile:function(t){this.clearTile(t);var e=this._canvasIDToFeatures[t];if(e){for(var i=e.features,r=[],s=0;s<i.length;s++){var n=i[s];n.selected?r.push(n):n.draw(t)}for(var o=0,a=r.length;o<a;o++){var l=r[o];l.draw(t)}}},_resetCanvasIDToFeatures:function(t,e){this._canvasIDToFeatures[t]={},this._canvasIDToFeatures[t].features=[],this._canvasIDToFeatures[t].canvas=e},linkedLayer:function(){if(this.mvtSource.layerLink){var t=this.mvtSource.layerLink(this.name);return this.mvtSource.layers[t]}return null},featureWithLabelAdded:function(t){this.featuresWithLabels.push(t)}})},{"./MVTFeature":8,"./MVTUtil":11}],10:[function(t,e,i){function r(t,e,i){var r=parseInt(Math.floor((e+180)/360*(1<<i))),s=parseInt(Math.floor((1-Math.log(Math.tan(t.toRad())+1/Math.cos(t.toRad()))/Math.PI)/2*(1<<i)));return""+i+":"+r+":"+s}function s(t,e){t.loadedTiles[e.id]=e}function n(t){for(var e in t.layers){var i=t.layers[e];o(i)}return t}function o(t){t.parsedFeatures=[];for(var e=t._features,i=0,r=e.length;i<r;i++){var s=t.feature(i);s.coordinates=s.loadGeometry(),t.parsedFeatures.push(s)}return t}var a=t("vector-tile").VectorTile,l=t("pbf"),h=(t("point-geometry"),t("./MVTUtil")),u=t("./MVTLayer");e.exports=L.TileLayer.MVTSource=L.TileLayer.Canvas.extend({options:{debug:!1,url:"",getIDForLayerFeature:function(){},tileSize:256,visibleLayers:[],xhrHeaders:{}},layers:{},processedTiles:{},_eventHandlers:{},_triggerOnTilesLoadedEvent:!0,_url:"",style:function(t){var e={},i=t.type;switch(i){case 1:e.color="rgba(49,79,79,1)",e.radius=5,e.selected={color:"rgba(255,255,0,0.5)",radius:6};break;case 2:e.color="rgba(161,217,155,0.8)",e.size=3,e.selected={color:"rgba(255,25,0,0.5)",size:4};break;case 3:e.color="rgba(49,79,79,1)",e.outline={color:"rgba(161,217,155,0.8)",size:1},e.selected={color:"rgba(255,140,0,0.3)",outline:{color:"rgba(255,140,0,1)",size:2}}}return e},initialize:function(t){L.Util.setOptions(this,t),this.layers={},this.activeTiles={},this.loadedTiles={},this._url=this.options.url,this.zIndex=t.zIndex,"function"==typeof t.style&&(this.style=t.style),"function"==typeof t.ajaxSource&&(this.ajaxSource=t.ajaxSource),this.layerLink=t.layerLink,this._eventHandlers={},this._tilesToProcess=0},redraw:function(t){t===!1&&(this._triggerOnTilesLoadedEvent=!1),L.TileLayer.Canvas.prototype.redraw.call(this)},onAdd:function(t){var e=this;e.map=t,L.TileLayer.Canvas.prototype.onAdd.call(this,t);var i=function(t){e._onClick(t)};t.on("click",i),t.on("layerremove",function(r){r.layer._leaflet_id===e._leaflet_id&&r.layer.removeChildLayers&&(r.layer.removeChildLayers(t),t.off("click",i))}),e.addChildLayers(t),"function"==typeof DynamicLabel&&(this.dynamicLabel=new DynamicLabel(t,this,{}))},drawTile:function(t,e,i){var r={id:[i,e.x,e.y].join(":"),canvas:t,tile:e,zoom:i,tileSize:this.options.tileSize};this._tilesToProcess<this._tilesToLoad&&(this._tilesToProcess=this._tilesToLoad);var s=r.id=h.getContextID(r);this.activeTiles[s]=r,this.processedTiles[r.zoom]||(this.processedTiles[r.zoom]={}),this.options.debug&&this._drawDebugInfo(r),this._draw(r)},setOpacity:function(t){this._setVisibleLayersStyle("opacity",t)},setZIndex:function(t){this._setVisibleLayersStyle("zIndex",t)},_setVisibleLayersStyle:function(t,e){for(var i in this.layers)this.layers[i]._tileContainer.style[t]=e},_drawDebugInfo:function(t){var e=this.options.tileSize,i=t.canvas.getContext("2d");i.strokeStyle="#000000",i.fillStyle="#FFFF00",i.strokeRect(0,0,e,e),i.font="12px Arial",i.fillRect(0,0,5,5),i.fillRect(0,e-5,5,5),i.fillRect(e-5,0,5,5),i.fillRect(e-5,e-5,5,5),i.fillRect(e/2-5,e/2-5,10,10),i.strokeText(t.zoom+" "+t.tile.x+" "+t.tile.y,e/2-30,e/2-10)},_draw:function(t){var e=this;if(this._url){var i=this.getTileUrl({x:t.tile.x,y:t.tile.y,z:t.zoom}),r=new XMLHttpRequest;r.onload=function(){if("200"==r.status){if(!r.response)return;var i=new Uint8Array(r.response),o=new l(i),h=new a(o);if(e.map&&e.map.getZoom()!=t.zoom)return void console.log("Fetched tile for zoom level "+t.zoom+". Map is at zoom level "+e._map.getZoom());e.checkVectorTileLayers(n(h),t),s(e,t)}e.reduceTilesToProcessCount()},r.onerror=function(){console.log("xhr error: "+r.status)},r.open("GET",i,!0);var o=e.options.xhrHeaders;for(var h in o)r.setRequestHeader(h,o[h]);r.responseType="arraybuffer",r.send()}},reduceTilesToProcessCount:function(){this._tilesToProcess--,this._tilesToProcess||(this._eventHandlers.PBFLoad&&this._eventHandlers.PBFLoad(),this._pbfLoaded())},checkVectorTileLayers:function(t,e,i){var r=this;if(r.options.visibleLayers&&r.options.visibleLayers.length>0)for(var s=0;s<r.options.visibleLayers.length;s++){var n=r.options.visibleLayers[s];t.layers[n]&&r.prepareMVTLayers(t.layers[n],n,e,i)}else for(var o in t.layers)r.prepareMVTLayers(t.layers[o],o,e,i)},prepareMVTLayers:function(t,e,i,r){var s=this;s.layers[e]||(s.layers[e]=s.createMVTLayer(e,t.parsedFeatures[0].type||null)),r?s.layers[e].getCanvas(i,t):s.layers[e].parseVectorTileLayer(t,i)},createMVTLayer:function(t,e){var i,r=this;i="function"==typeof r.options.getIDForLayerFeature?r.options.getIDForLayerFeature:h.getIDForLayerFeature;var s={getIDForLayerFeature:i,
filter:r.options.filter,layerOrdering:r.options.layerOrdering,style:r.style,name:t,asynch:!0};r.options.zIndex&&(s.zIndex=r.zIndex);var n=new u(r,s).addTo(r.map);return n},getLayers:function(){return this.layers},hideLayer:function(t){this.layers[t]&&(this._map.removeLayer(this.layers[t]),this.options.visibleLayers.indexOf("id")>-1&&this.visibleLayers.splice(this.options.visibleLayers.indexOf("id"),1))},showLayer:function(t){this.layers[t]&&(this._map.addLayer(this.layers[t]),this.options.visibleLayers.indexOf("id")==-1&&this.visibleLayers.push(t)),this.bringToFront()},removeChildLayers:function(t){for(var e in this.layers){var i=this.layers[e];t.removeLayer(i)}},addChildLayers:function(t){var e=this;if(e.options.visibleLayers.length>0)for(var i=0;i<e.options.visibleLayers.length;i++){var r=e.options.visibleLayers[i],s=this.layers[r];s&&t.addLayer(s)}else for(var n in this.layers){var s=this.layers[n];s._map||t.addLayer(s)}},bind:function(t,e){this._eventHandlers[t]=e},_onClick:function(t){var e=this,i=e.options.onClick,s=e.options.clickableLayers,n=e.layers;if(t.tileID=r(t.latlng.lat,t.latlng.lng,this.map.getZoom()),s||(s=Object.keys(e.layers)),s&&s.length>0)for(var o=0,a=s.length;o<a;o++){var l=s[o],h=n[l];h&&h.handleClickEvent(t,function(t){"function"==typeof i&&i(t)})}else"function"==typeof i&&i(t)},setFilter:function(t,e){for(var i in this.layers){var r=this.layers[i];e?i.toLowerCase()==e.toLowerCase()&&(r.options.filter=t,r.clearLayerFeatureHash()):(r.options.filter=t,r.clearLayerFeatureHash())}},setStyle:function(t,e){for(var i in this.layers){var r=this.layers[i];e?i.toLowerCase()==e.toLowerCase()&&r.setStyle(t):r.setStyle(t)}},featureSelected:function(t){this.options.mutexToggle&&(this._selectedFeature&&this._selectedFeature.deselect(),this._selectedFeature=t),this.options.onSelect&&this.options.onSelect(t)},featureDeselected:function(t){this.options.mutexToggle&&this._selectedFeature&&(this._selectedFeature=null),this.options.onDeselect&&this.options.onDeselect(t)},_pbfLoaded:function(){this.bringToFront();var t=this,e=t.options.onTilesLoaded;e&&"function"==typeof e&&this._triggerOnTilesLoadedEvent===!0&&e(this),t._triggerOnTilesLoadedEvent=!0}}),"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180})},{"./MVTLayer":9,"./MVTUtil":11,pbf:2,"point-geometry":3,"vector-tile":4}],11:[function(t,e,i){var r=e.exports={};r.getContextID=function(t){return[t.zoom,t.tile.x,t.tile.y].join(":")},r.getIDForLayerFeature=function(t){return t.properties.id},r.getJSON=function(t,e){var i="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");i.onreadystatechange=function(){var t=i.status;if(4===i.readyState&&t>=200&&t<300){var r=JSON.parse(i.responseText);e(null,r)}else e({error:!0,status:t})},i.open("GET",t,!0),i.send()}},{}],12:[function(t,e,i){function r(t,e,i,r){var n=this;if(this.mvtFeature=t,this.map=t.map,this.zoom=e.zoom,this.latLng=i,this.selected=!1,t.linkedFeature){var o=t.linkedFeature();o&&o.selected&&(n.selected=!0)}s(n,t,e,i,r)}function s(t,e,i,r,s){var n=e.ajaxData,o=t.style=s.staticLabel(e,n),a=t.icon=L.divIcon({className:o.cssClass||"label-icon-text",html:o.html,iconSize:o.iconSize||[50,50]});t.marker=L.marker(r,{icon:a}).addTo(t.map),t.selected&&t.marker._icon.classList.add(t.style.cssSelectedClass||"label-icon-text-selected"),t.marker.on("click",function(e){t.toggle()}),t.map.on("zoomend",function(e){var i=e.target.getZoom();t.zoom!==i&&t.map.removeLayer(t.marker)})}t("../MVTUtil");e.exports=r,r.prototype.toggle=function(){this.selected?this.deselect():this.select()},r.prototype.select=function(){this.selected=!0,this.marker._icon.classList.add(this.style.cssSelectedClass||"label-icon-text-selected");var t=this.mvtFeature.linkedFeature();t.selected||t.select()},r.prototype.deselect=function(){this.selected=!1,this.marker._icon.classList.remove(this.style.cssSelectedClass||"label-icon-text-selected");var t=this.mvtFeature.linkedFeature();t.selected&&t.deselect()},r.prototype.remove=function(){this.map&&this.marker&&this.map.removeLayer(this.marker)}},{"../MVTUtil":11}],13:[function(t,e,i){/**
 * Copyright (c) 2014, Spatial Development International
 * All rights reserved.
 *
 * Source code can be found at:
 * https://github.com/SpatialServer/Leaflet.MapboxVectorTile
 *
 * @license ISC
 */
e.exports=t("./MVTSource")},{"./MVTSource":10}]},{},[13]);
